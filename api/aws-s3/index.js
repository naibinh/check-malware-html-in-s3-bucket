const AWS = require('aws-sdk');
AWS.config.loadFromPath(__dirname + '/../../config/s3/credential.json');

const AWS_S3_URL = 'https://s3.amazonaws.com';
const params = require('../../config/s3/bucket');
const s3 = new AWS.S3();

const getHtmlUrls = () => {
    return new Promise((resolve, reject) => {
        s3.listObjects(params, (err, data) => {
            if (err) {
                reject(err);
            }
            else {
                const htmlUrls = data.Contents
                    .filter(content => content.Key.endsWith('.html'))
                    .map(content => ({
                        url: `${AWS_S3_URL}/${params.Bucket}/${content.Key}`
                    }));
                resolve(htmlUrls);
            }
        });
    });
};

module.exports = getHtmlUrls;