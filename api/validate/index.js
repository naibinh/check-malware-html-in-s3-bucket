/*Follow this guide to use Google Safe Browsing
* https://developers.google.com/safe-browsing/v4/get-started
* Remember to enable 'Safe Browsing API' for corresponding API_KEY
* */

const axios = require('axios');
const chunk = require('lodash').chunk;
const getRequestBody = require('./requestBody');
const API_KEY = require('../../config/google/api_key');
const SAFE_BROWSING_URL = `https://safebrowsing.googleapis.com/v4/threatMatches:find?key=${API_KEY}`;

const validate = (urls) => {
    const chunkedUrls = chunk(urls, 500); // the HTTP POST request can include up to 500 URLs.
    const exec = chunkedUrls.map(chunk => axios.post(SAFE_BROWSING_URL, getRequestBody(chunk), { headers: { 'content-type': 'application/json' } }));
    return Promise.all(exec);
};

module.exports = validate;